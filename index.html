
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos 數位觀課儀表板 - Pop Art Edition</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', 'Orbitron', sans-serif;
            background-color: #000000;
            background-image: radial-gradient(#111 1px, transparent 0);
            background-size: 24px 24px;
            color: #00f2ff;
            overflow-x: hidden;
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        @keyframes rotate-dashed {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-rotate-slow {
            animation: rotate-dashed 12s linear infinite;
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.8), 0 0 20px rgba(0, 242, 255, 0.3);
        }

        .glass {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid #00f2ff;
        }

        .pulse-reminder {
            animation: neon-pulse 1.5s infinite;
        }
        @keyframes neon-pulse {
            0%, 100% { border-color: #00f2ff; box-shadow: 0 0 10px #00f2ff; }
            50% { border-color: #ff00ff; box-shadow: 0 0 25px #ff00ff; }
        }

        .halftone-dots {
            background-image: radial-gradient(currentColor 2px, transparent 2px);
            background-size: 8px 8px;
            opacity: 0.1;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #000; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #00f2ff; border: 2px solid #000; }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2300f2ff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useEffect, useRef } = React;

        // --- Constants & Types ---
        const INITIAL_STATE = {
            isSessionActive: false,
            startTime: null,
            endTime: null,
            currentMode: null,
            modeDurations: {
                '講述教學': 0, '小組討論': 0, '實作/演算': 0, '數位運用': 0, '教師回饋': 0, '教師巡視': 0
            },
            actionCounts: {
                '正向鼓勵': 0, '糾正規範': 0, '開放提問': 0, '封閉提問': 0, '巡視走動': 0
            },
            logs: [],
            lastInteractionTime: Date.now()
        };

        const formatDuration = (s) => {
            const mins = Math.floor(s / 60);
            const secs = s % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        // --- Components ---

        const Header = ({ isSessionActive, onToggleSession, subject, setSubject }) => {
            const [time, setTime] = useState(new Date().toLocaleTimeString('zh-TW', { hour12: false }));

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date().toLocaleTimeString('zh-TW', { hour12: false })), 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <header className="glass sticky top-0 z-50 px-6 py-4 flex items-center justify-between border-b-4 border-cyan-400">
                    <div className="flex items-center gap-6">
                        <div className="flex flex-col">
                            <h1 className="text-3xl font-black italic tracking-tighter text-cyan-400 neon-text font-orbitron">CHRONOS</h1>
                            <p className="text-cyan-400 text-[10px] font-bold tracking-[0.3em] uppercase">POP-ART v2.1</p>
                        </div>
                        <select 
                            value={subject}
                            onChange={(e) => setSubject(e.target.value)}
                            disabled={isSessionActive}
                            className="bg-black border-2 border-cyan-400 px-4 py-2 text-sm font-bold text-cyan-400 uppercase tracking-widest outline-none"
                        >
                            {['國文', '英文', '數學', '自然', '社會', '體育', '藝術', '數位應用'].map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                    </div>
                    <div className="flex items-center gap-8">
                        <div className="hidden md:flex flex-col items-end">
                            <span className="text-3xl font-black text-cyan-400 font-orbitron neon-text">{time}</span>
                            <span className="text-[10px] text-cyan-700 font-black uppercase">Sync Active</span>
                        </div>
                        <button onClick={onToggleSession} className="active:scale-95 transition-transform">
                            {isSessionActive ? (
                                <div className="border-4 border-red-500 bg-black text-red-500 px-6 py-3 font-black uppercase shadow-[4px_4px_0px_#7f1d1d] flex items-center gap-2 hover:bg-red-500 hover:text-black">
                                    <div className="w-4 h-4 bg-current" /> STOP MISSION
                                </div>
                            ) : (
                                <div className="border-4 border-cyan-400 bg-black text-cyan-400 px-6 py-3 font-black uppercase shadow-[4px_4px_0px_#0066ff] flex items-center gap-2 hover:bg-cyan-400 hover:text-black">
                                    <div className="w-4 h-4 border-2 border-current rounded-full animate-ping" /> START
                                </div>
                            )}
                        </button>
                    </div>
                </header>
            );
        };

        const ModeCard = ({ mode, isActive, duration, onClick, disabled }) => (
            <button
                onClick={onClick}
                disabled={disabled}
                className={`relative h-32 border-4 p-4 flex flex-col justify-between transition-all group ${
                    isActive ? 'bg-cyan-400 text-black border-cyan-400 shadow-[8px_8px_0px_#0066ff]' : 'bg-black border-cyan-400 text-cyan-400 shadow-[4px_4px_0px_#004466]'
                } ${disabled ? 'opacity-20 cursor-not-allowed' : 'cursor-pointer'}`}
            >
                <div className="absolute inset-0 halftone-dots pointer-events-none" />
                <span className="text-lg font-black uppercase leading-none z-10">{mode}</span>
                <div className="z-10 text-left">
                    <span className="text-3xl font-black font-orbitron">{formatDuration(duration)}</span>
                    <p className="text-[10px] font-black uppercase tracking-tighter opacity-70">Accumulated</p>
                </div>
            </button>
        );

        const ActionButton = ({ action, count, onClick, disabled }) => (
            <button
                onClick={onClick}
                disabled={disabled}
                className={`px-6 py-4 border-4 flex items-center gap-4 transition-all active:translate-x-1 active:translate-y-1 ${
                    disabled ? 'opacity-20 border-gray-800' : 'border-cyan-400 bg-black hover:bg-cyan-400 hover:text-black shadow-[4px_4px_0px_#0066ff]'
                }`}
            >
                <div className="w-10 h-10 border-2 border-current flex items-center justify-center text-xl font-black font-orbitron">{count}</div>
                <span className="text-lg font-black uppercase">{action}</span>
            </button>
        );

        const LogStream = ({ logs }) => (
            <div className="flex flex-col h-full bg-black">
                <div className="bg-cyan-400 p-2 text-[10px] text-black font-black uppercase flex justify-between">
                    <span>TIMELINE</span><span>EVENT LOG</span>
                </div>
                <div className="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar">
                    {logs.length === 0 ? (
                        <div className="h-full flex items-center justify-center text-cyan-900 font-black italic opacity-30">NO DATA YET...</div>
                    ) : (
                        logs.map(log => (
                            <div key={log.id} className="flex gap-4 items-start border-l-2 border-cyan-900 pl-4">
                                <span className="text-xs font-black font-orbitron text-cyan-800">{new Date(log.timestamp).toLocaleTimeString('zh-TW', {hour12:false})}</span>
                                <div className="flex flex-col">
                                    <span className={`text-sm font-black uppercase ${log.type==='action'?'text-white':'text-cyan-400'}`}>{log.name}</span>
                                    {log.value && <span className="text-[10px] text-cyan-700 font-bold">>> {log.value}</span>}
                                </div>
                            </div>
                        ))
                    )}
                </div>
            </div>
        );

        const ReportModal = ({ state, subject, onClose, onReset }) => {
            const getReportText = () => {
                let t = `[ CHRONOS REPORT ]\nSUBJECT: ${subject}\nSTART: ${new Date(state.startTime).toLocaleString()}\n\n[ MODES ]\n`;
                Object.entries(state.modeDurations).forEach(([k,v])=> t += `${k}: ${formatDuration(v)}\n`);
                return t;
            };
            const download = () => {
                const blob = new Blob(["\uFEFF"+getReportText()], {type:'text/plain'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `LOG_${subject}.txt`;
                a.click();
            };
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
                    <div className="bg-black w-full max-w-2xl border-8 border-cyan-400 flex flex-col shadow-[20px_20px_0px_#0066ff]">
                        <div className="p-8 bg-cyan-400 text-black flex justify-between items-center">
                            <h2 className="text-4xl font-black italic tracking-tighter">MISSION LOG</h2>
                            <button onClick={onClose} className="text-black font-black text-2xl">X</button>
                        </div>
                        <div className="p-8 space-y-6 overflow-y-auto max-h-[60vh] halftone-dots text-cyan-400">
                            <div className="grid grid-cols-2 gap-4">
                                <div className="border-4 border-cyan-400 p-4 font-black">
                                    <div className="text-[10px] opacity-60">TOTAL DURATION</div>
                                    <div className="text-3xl font-orbitron">{formatDuration(Math.floor((state.endTime-state.startTime)/1000))}</div>
                                </div>
                                <div className="border-4 border-cyan-400 p-4 font-black">
                                    <div className="text-[10px] opacity-60">SUBJECT</div>
                                    <div className="text-3xl">{subject}</div>
                                </div>
                            </div>
                            <div className="space-y-2">
                                {Object.entries(state.modeDurations).map(([k,v])=>(
                                    <div key={k} className="flex justify-between border-b border-cyan-900 pb-1">
                                        <span className="font-bold opacity-70">{k}</span>
                                        <span className="font-orbitron font-black">{formatDuration(v)}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="p-8 border-t-4 border-cyan-400 flex flex-wrap gap-4">
                            <button onClick={download} className="flex-1 py-4 bg-cyan-400 text-black font-black text-xl shadow-[4px_4px_0px_#0066ff]">DOWNLOAD</button>
                            <button onClick={onReset} className="w-full py-4 border-4 border-red-500 text-red-500 font-black shadow-[4px_4px_0px_#7f1d1d]">RESTART</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [state, setState] = useState(INITIAL_STATE);
            const [subject, setSubject] = useState('國文');
            const [showReport, setShowReport] = useState(false);
            const [isReminderActive, setIsReminderActive] = useState(false);
            const [noteText, setNoteText] = useState('');
            const timerRef = useRef(null);

            useEffect(() => {
                if (state.isSessionActive && state.currentMode) {
                    timerRef.current = setInterval(() => {
                        setState(prev => ({
                            ...prev,
                            modeDurations: { ...prev.modeDurations, [prev.currentMode]: prev.modeDurations[prev.currentMode] + 1 }
                        }));
                    }, 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [state.isSessionActive, state.currentMode]);

            useEffect(() => {
                const rem = setInterval(() => {
                    if(state.isSessionActive && Date.now() - state.lastInteractionTime > 300000) setIsReminderActive(true);
                }, 10000);
                return () => clearInterval(rem);
            }, [state.isSessionActive, state.lastInteractionTime]);

            const addLog = (entry) => {
                const now = Date.now();
                setState(prev => ({
                    ...prev,
                    lastInteractionTime: now,
                    logs: [{ id: Math.random().toString(36).substr(2, 9), timestamp: now, ...entry }, ...prev.logs]
                }));
            };

            const toggleSession = () => {
                if (!state.isSessionActive) {
                    setState(prev => ({ ...prev, isSessionActive: true, startTime: Date.now(), lastInteractionTime: Date.now(), logs: [] }));
                    addLog({ type: 'note', name: '觀課啟動', value: subject });
                } else {
                    setState(prev => ({ ...prev, isSessionActive: false, endTime: Date.now(), currentMode: null }));
                    setShowReport(true);
                }
            };

            const handleAction = (action) => {
                if (!state.isSessionActive) return;
                setState(prev => ({ ...prev, actionCounts: { ...prev.actionCounts, [action]: prev.actionCounts[action] + 1 }, lastInteractionTime: Date.now() }));
                addLog({ type: 'action', name: action });
            };

            const handleMode = (mode) => {
                if (!state.isSessionActive) return;
                const nextMode = state.currentMode === mode ? null : mode;
                setState(prev => ({ ...prev, currentMode: nextMode, lastInteractionTime: Date.now() }));
                addLog({ type: 'mode', name: nextMode ? `切換：${mode}` : `結束：${mode}` });
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <Header isSessionActive={state.isSessionActive} onToggleSession={toggleSession} subject={subject} setSubject={setSubject} />
                    <main className="flex-1 flex flex-col md:flex-row p-6 gap-8 overflow-hidden">
                        <section className="flex-1 space-y-8">
                            <h2 className="text-3xl font-black italic neon-text uppercase tracking-tighter">Teaching Modes</h2>
                            <div className="grid grid-cols-2 lg:grid-cols-3 gap-4">
                                {Object.keys(state.modeDurations).map(m => (
                                    <ModeCard key={m} mode={m} isActive={state.currentMode===m} duration={state.modeDurations[m]} onClick={()=>handleMode(m)} disabled={!state.isSessionActive} />
                                ))}
                            </div>
                            <h2 className="text-3xl font-black italic neon-text uppercase tracking-tighter mt-12">Actions</h2>
                            <div className="flex flex-wrap gap-4">
                                {Object.keys(state.actionCounts).map(a => (
                                    <ActionButton key={a} action={a} count={state.actionCounts[a]} onClick={()=>handleAction(a)} disabled={!state.isSessionActive} />
                                ))}
                            </div>
                        </section>
                        <section className="md:w-96 flex flex-col space-y-4">
                            <h2 className="text-3xl font-black italic neon-text uppercase tracking-tighter">Live Log</h2>
                            <div className="flex-1 border-4 border-cyan-400 overflow-hidden halftone-dots">
                                <LogStream logs={state.logs} />
                            </div>
                        </section>
                    </main>
                    <footer className={`glass p-6 border-t-4 border-cyan-400 flex flex-col md:flex-row gap-8 items-center ${isReminderActive?'pulse-reminder':''}`}>
                        <div className="flex bg-black p-1 gap-2 border-2 border-cyan-900">
                            {['HIGH','MID','LOW'].map(l => (
                                <button key={l} onClick={()=>{addLog({type:'engagement',name:`專注度:${l}`});setIsReminderActive(false)}} disabled={!state.isSessionActive} className="px-6 py-2 border-2 border-cyan-400 font-black text-xs hover:bg-cyan-400 hover:text-black disabled:opacity-20 uppercase">{l}</button>
                            ))}
                        </div>
                        <div className="flex-1 w-full relative">
                            <input 
                                value={noteText} onChange={e=>setNoteText(e.target.value)} disabled={!state.isSessionActive}
                                onKeyDown={e=>e.key==='Enter' && (addLog({type:'note',name:'筆記',value:noteText}), setNoteText(''))}
                                placeholder="ENTER DATA..." className="w-full bg-black border-4 border-cyan-400 px-6 py-4 font-black text-cyan-400 uppercase tracking-widest outline-none focus:shadow-[0_0_20px_#00f2ff]" 
                            />
                        </div>
                    </footer>
                    {showReport && <ReportModal state={state} subject={subject} onClose={()=>setShowReport(false)} onReset={()=>{setState(INITIAL_STATE);setShowReport(false)}} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
